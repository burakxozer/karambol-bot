<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karambol Kriket w/ DartBot</title>

<style>
body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui}
.app{max-width:900px;margin:auto;padding:12px;position:relative}
h1{text-align:center}
.top-right{position:absolute;top:10px;right:16px;font-size:14px;opacity:.9}
.card{background:#111827;border-radius:16px;padding:14px;margin-bottom:12px}
button{width:100%;padding:14px;font-size:18px;border:none;border-radius:14px;background:#22c55e;color:#000;margin-top:10px}
button.gray{background:#374151;color:#fff}
select{width:100%;padding:12px;font-size:18px;border-radius:12px;margin-top:10px}
.screen{display:none}
.active{display:block}
.board{border-top:2px solid #374151;margin-top:10px}
.row{display:grid;grid-template-columns:1fr 60px 1fr;border-bottom:1px solid #374151}
.cell{height:46px;display:flex;align-items:center;justify-content:center;font-size:22px}
.mid{font-weight:700}
.popup{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center}
.popup-inner{background:#111827;padding:22px;border-radius:18px;width:90%;max-width:380px;text-align:center}
.throw{margin:6px 0;font-size:18px}
.win{font-size:34px;color:#22c55e}
.lose{font-size:34px;color:#ef4444}
</style>
</head>

<body>
<div class="app">
<h1>üéØ Karambol Kriket w/ DartBot</h1>
<div id="levelInfo" class="top-right"></div>

<div id="start" class="card screen active">
<h2>Ma√ß T√ºr√º</h2>
<button onclick="startGame()">Oyuna Ba≈üla</button>

<h2>Dart Bot Seviyesi</h2>
<select id="botLevel">
  <option value="1">Level 1</option><option value="2">Level 2</option>
  <option value="3">Level 3</option><option value="4">Level 4</option>
  <option value="5">Level 5</option><option value="6">Level 6</option>
  <option value="7">Level 7</option><option value="8">Level 8</option>
  <option value="9">Level 9</option><option value="10">Level 10</option>
</select>
</div>

<div id="game" class="card screen">
<h2 id="turnInfo"></h2>
<div id="board" class="board"></div>
<button class="gray" onclick="undo()">UNDO (Bu El)</button>
<button onclick="endPlayer()">Dart Bota Ge√ß</button>
<button class="gray" onclick="restart()">üîÑ Oyunu Ba≈ütan Ba≈ülat</button>
</div>
</div>

<div id="popup" class="popup">
  <div class="popup-inner" id="popupContent"></div>
</div>

<script>
const targets=["20","19","18","17","16","15","14","13","12","D","T","B","H"];
const marks=["","/","X","‚≠ï"];
const ring=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];

let scores,turn="player",snapshot,botLevel=5,matchScore=[0,0],bestOf=1;

/* === GAME START === */
function startGame(){
  botLevel=parseInt(document.getElementById("botLevel").value);
  document.getElementById("levelInfo").textContent=`ü§ñ Dart Bot Level: ${botLevel}`;
  scores=[Array(13).fill(0),Array(13).fill(0)];
  turn=Math.random()<0.5?"player":"bot";
  snapshot=JSON.parse(JSON.stringify(scores));
  show("game");
  render();
  updateTurn();
  if(turn==="bot") botTurn();
}

function restart(){ show("start"); }

function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* === RENDER BOARD === */
function render(){
  board.innerHTML="";
  targets.forEach((t,i)=>{
    let r=document.createElement("div");r.className="row";
    let l=document.createElement("div");l.className="cell";
    l.textContent=marks[scores[0][i]];
    l.onclick=()=>{
      if(turn!=="player")return;
      snapshot=JSON.parse(JSON.stringify(scores));
      scores[0][i]=Math.min(3,scores[0][i]+1);
      render();checkWin();
    };
    let m=document.createElement("div");m.className="cell mid";m.textContent=t;
    let rt=document.createElement("div");rt.className="cell";
    rt.textContent=marks[scores[1][i]];
    r.append(l,m,rt);board.appendChild(r);
  });
}

function updateTurn(){
  turnInfo.textContent=turn==="player"?"Senin Atƒ±≈üƒ±n":"Dart Bot Atƒ±yor";
}

/* === UNDO ACTION === */
function undo(){
  if(turn!=="player")return;
  scores=JSON.parse(JSON.stringify(snapshot));
  render();
}

/* === PLAYER END === */
function endPlayer(){
  snapshot=JSON.parse(JSON.stringify(scores));
  turn="bot";
  updateTurn();
  botTurn();
}

/* === BOT AI === */
function levelAcc(){
  if(botLevel<=3) return {hit:.35,near:.4};
  if(botLevel<=6) return {hit:.55,near:.3};
  if(botLevel<=8) return {hit:.7,near:.2};
  return {hit:.82,near:.12};
}

function nextTarget(){
  for(let i=0;i<=8;i++) if(scores[1][i]<3) return parseInt(targets[i]);
  if(scores[1][10]<3) return "T";
  if(scores[1][9]<3) return "D";
  if(scores[1][12]<3) return "H";
  if(scores[1][11]<3) return "B";
  return null;
}

function botTurn(){
  popup.style.display="flex";
  popupContent.innerHTML="<h3>Dart Bot Atƒ±yor</h3>";
  let throws=[],i=0;
  let iv=setInterval(()=>{
    let t=botThrow();
    throws.push(t);
    popupContent.innerHTML+=`<div class="throw">${i+1}. Ok: ${t.text}</div>`;
    i++;
    if(i===3){ clearInterval(iv); setTimeout(()=>botWrite(throws),800); }
  },900);
}

function botThrow(){
  let {hit}=levelAcc();
  let landed=Math.random()<hit?nextTarget():ring[Math.floor(Math.random()*20)];

  if(landed==="B"){
    let rb=Math.random();
    return rb<0.16
      ?{num:"B",bull:2,text:"Redbull"}
      :{num:"B",bull:1,text:"Bull"};
  }

  let rm=Math.random(),mult=1;
  if(rm<0.08) mult=3;
  else if(rm<0.2) mult=2;

  return {num:landed,mult,text:`${landed} ${["Single","Double","Triple"][mult-1]}`};
}

/* === BOT WRITE TO SCOREBOARD === */
function botWrite(throws){
  let nums=throws.map(t=>t.num);
  let same=nums.every(n=>n===nums[0]);
  let D=9,T=10,B=11,H=12;

  if(same && scores[1][H]<3){
    scores[1][H]++;
    popupContent.innerHTML+="<div class='throw'>HOUSE</div>";
  }else{
    throws.forEach(t=>{
      if(t.num==="B"){
        scores[1][B]=Math.min(3,scores[1][B]+t.bull);return;
      }
      let idx=targets.indexOf(String(t.num));
      if(t.mult===3){
        if(scores[1][T]<3) scores[1][T]++;
        else scores[1][idx]=3;
        return;
      }
      if(t.mult===2){
        if(scores[1][D]<3) scores[1][D]++;
        else scores[1][idx]=Math.min(3,scores[1][idx]+2);
        return;
      }
      scores[1][idx]=Math.min(3,scores[1][idx]+1);
    });
  }

  popup.style.display="none";
  turn="player"; updateTurn(); render(); checkWin();
}

/* === CHECK WIN === */
function checkWin(){
  let p=scores[0].every(v=>v>=3);
  let b=scores[1].every(v=>v>=3);
  if(!p&&!b)return;
  popup.style.display="flex";
  popupContent.innerHTML=p
    ?"<div class='win'>üèÜ KAZANDIN</div>"
    :"<div class='lose'>‚ùå KAYBETTƒ∞N</div>";

  setTimeout(()=>{
    popup.style.display="none";
    show("start");
  },2000);
}
</script>
</body>
</html>
